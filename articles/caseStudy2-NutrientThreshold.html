<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Case study: Nutrient thresholds • miaSim</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Case study: Nutrient thresholds">
<meta property="og:description" content="miaSim">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">miaSim</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/miaSim.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/caseStudy1-SIS.html">Case study: SIS</a>
    </li>
    <li>
      <a href="../articles/caseStudy2-NutrientThreshold.html">Case study: Nutrient thresholds</a>
    </li>
    <li>
      <a href="../articles/caseStudy3-EnvironmentalComplexity.html">Case study: Environmental complexity</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/microbiome/miaSim/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Case study: Nutrient thresholds</h1>
                        <h4 data-toc-skip class="author">The miaSim
package authors.</h4>
            
            <h4 data-toc-skip class="date">2022-12-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/microbiome/miaSim/blob/HEAD/vignettes/caseStudy2-NutrientThreshold.Rmd" class="external-link"><code>vignettes/caseStudy2-NutrientThreshold.Rmd</code></a></small>
      <div class="hidden name"><code>caseStudy2-NutrientThreshold.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="case-study-with-miasim-nutrient-concentration-threshold">Case study with miaSim: Nutrient concentration threshold<a class="anchor" aria-label="anchor" href="#case-study-with-miasim-nutrient-concentration-threshold"></a>
</h2>
<p>Reference: <a href="https://doi.org/10.1371/journal.pcbi.1006793" class="external-link">Available energy
fluxes drive a transition in the diversity, stability, and functional
structure of microbial communities</a>.</p>
<p>The aim of this case study is to design and demonstrate the existence
of nutrient concentration threshold which limits the beta-diversity of
communities.</p>
<p>To fulfill this aim, we designed a gradient of environments, as well
as a gradient of communities.</p>
<div class="section level3">
<h3 id="load-dependencies">Load dependencies<a class="anchor" aria-label="anchor" href="#load-dependencies"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/vegandevs/vegan" class="external-link">vegan</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/microbiome/miaSim" class="external-link">miaSim</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/drostlab/philentropy" class="external-link">philentropy</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/cluster/" class="external-link">cluster</a></span><span class="op">)</span></span></code></pre></div>
<p>(This batch of simulations is time-consuming. To reduce the
calculation burden, we decreased the numbers of environments, resources,
and communities from the original 10 to 5, and made other minor
modifications.)</p>
</div>
<div class="section level3">
<h3 id="set-random-seed-and-initial-shared-parameters">Set random seed and initial shared parameters<a class="anchor" aria-label="anchor" href="#set-random-seed-and-initial-shared-parameters"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">n_species</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">n_resources</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">E</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/randomE.html">randomE</a></span><span class="op">(</span><span class="va">n_species</span>, <span class="va">n_resources</span>, mean_consumption <span class="op">=</span> <span class="fl">1</span>, mean_production <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">growth_rates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_species</span><span class="op">)</span></span>
<span><span class="va">monod_constant</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="va">n_species</span><span class="op">*</span><span class="va">n_resources</span>, <span class="fl">10</span>,<span class="fl">10</span><span class="op">)</span>,nrow<span class="op">=</span><span class="va">n_species</span>, ncol<span class="op">=</span><span class="va">n_resources</span><span class="op">)</span></span>
<span><span class="va">t_store</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">n.instances</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># no stochastic process: no need to repeat</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generating-function">generating function<a class="anchor" aria-label="anchor" href="#generating-function"></a>
</h3>
<p>this function generates a data frame, where each row is arranged in
an increasing dissimilarity to the first row.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gradient.df.generator</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_row</span>, <span class="va">n_col</span>, <span class="va">density_row</span>, <span class="va">max_gradient</span>, <span class="va">error_interval</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">list_initial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">dissimilarity.gradient</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="va">max_gradient</span>, length.out <span class="op">=</span> <span class="va">n_row</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_row</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>            <span class="va">row_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="va">n_col</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">/</span><span class="va">n_col</span><span class="op">)</span></span>
<span>            <span class="va">col_to_remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_col</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">n_col</span><span class="op">-</span><span class="va">n_col</span><span class="op">*</span><span class="va">density_row</span><span class="op">)</span></span>
<span>            <span class="va">row_temp</span><span class="op">[</span><span class="va">col_to_remove</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>            <span class="va">list_initial</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">row_temp</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>            <span class="kw">while</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">list_initial</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">row_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="va">n_col</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">/</span><span class="va">n_col</span><span class="op">)</span></span>
<span>                <span class="va">col_to_remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_col</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">n_col</span><span class="op">-</span><span class="va">n_col</span><span class="op">*</span><span class="va">density_row</span><span class="op">)</span></span>
<span>                <span class="va">row_temp</span><span class="op">[</span><span class="va">col_to_remove</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>                <span class="va">diff_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html" class="external-link">vegdist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">list_initial</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">row_temp</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span> <span class="op">-</span> <span class="va">dissimilarity.gradient</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>                <span class="kw">if</span> <span class="op">(</span><span class="va">diff_temp</span> <span class="op">&lt;</span> <span class="va">error_interval</span><span class="op">)</span> <span class="op">{</span></span>
<span>                    <span class="va">list_initial</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">row_temp</span></span>
<span>                <span class="op">}</span></span>
<span>            <span class="op">}</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">dataframe_to_return</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">list_initial</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">n_row</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">dataframe_to_return</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generate-communities">generate communities<a class="anchor" aria-label="anchor" href="#generate-communities"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n.community</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="co"># you can also try 20 or even 50.</span></span>
<span><span class="va">density.community</span> <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">community.initial.df</span> <span class="op">&lt;-</span> <span class="fu">gradient.df.generator</span><span class="op">(</span>n_row <span class="op">=</span> <span class="va">n.community</span>, n_col <span class="op">=</span> <span class="va">n_species</span>, density_row <span class="op">=</span> <span class="va">density.community</span>, max_gradient <span class="op">=</span> <span class="fl">0.7</span>, error_interval <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1</span></span>
<span><span class="co">## [1] 2</span></span>
<span><span class="co">## [1] 3</span></span>
<span><span class="co">## [1] 4</span></span>
<span><span class="co">## [1] 5</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dist.community.initial.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html" class="external-link">vegdist</a></span><span class="op">(</span><span class="va">community.initial.df</span>, method <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">community.initial.tse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TreeSummarizedExperiment/man/TreeSummarizedExperiment-constructor.html" class="external-link">TreeSummarizedExperiment</a></span><span class="op">(</span>assays<span class="op">=</span><span class="fu">SimpleList</span><span class="op">(</span>abundances<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">community.initial.df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="load-plotting-functions">load plotting functions<a class="anchor" aria-label="anchor" href="#load-plotting-functions"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">makePlot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">out_matrix</span>, <span class="va">title</span> <span class="op">=</span> <span class="st">"abundance of species by time"</span>, <span class="va">obj</span> <span class="op">=</span> <span class="st">"species"</span>, <span class="va">y.label</span> <span class="op">=</span> <span class="st">"x.t"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">out_matrix</span><span class="op">)</span></span>
<span>    <span class="va">dft</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">df</span>, id<span class="op">=</span><span class="st">"time"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dft</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="va">obj</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dft</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">=</span> <span class="va">y.label</span></span>
<span>    <span class="va">lgd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">&lt;=</span> <span class="fl">20</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dft</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html" class="external-link">aes_string</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dft</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dft</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dft</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="va">lgd</span>, lwd<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_linedraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">makePlotRes</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">out_matrix</span>, <span class="va">title</span> <span class="op">=</span> <span class="st">"quantity of compounds by time"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">out_matrix</span><span class="op">)</span></span>
<span>    <span class="va">dft</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">df</span>, id<span class="op">=</span><span class="st">"time"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dft</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="st">"resources"</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dft</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">=</span> <span class="st">"S.t"</span></span>
<span>    <span class="va">lgd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">&lt;=</span> <span class="fl">20</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dft</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">S.t</span>, col <span class="op">=</span> <span class="va">resources</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="va">lgd</span>, lwd<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_linedraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">makeHeatmap</span> <span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">matrix.A</span>,</span>
<span>                       <span class="va">title</span> <span class="op">=</span> <span class="st">"Consumption/production matrix"</span>,</span>
<span>                       <span class="va">y.label</span> <span class="op">=</span> <span class="st">'resources'</span>,</span>
<span>                       <span class="va">x.label</span> <span class="op">=</span> <span class="st">'species'</span>,</span>
<span>                       <span class="va">midpoint_color</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                       <span class="va">lowColor</span> <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>                       <span class="va">midColor</span> <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>                       <span class="va">highColor</span> <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">matrix.A</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">midpoint_color</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">midpoint_color</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"strength"</span><span class="op">)</span></span>
<span>    <span class="va">df</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">y</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">fig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,fill<span class="op">=</span><span class="va">strength</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span><span class="st">'strength'</span>, low <span class="op">=</span> <span class="va">lowColor</span>, mid <span class="op">=</span> <span class="va">midColor</span>, high <span class="op">=</span> <span class="va">highColor</span>, midpoint <span class="op">=</span> <span class="va">midpoint_color</span><span class="op">)</span><span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">matrix.A</span><span class="op">)</span><span class="op">&lt;=</span><span class="fl">10</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">matrix.A</span><span class="op">)</span><span class="op">&lt;=</span><span class="fl">10</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">fig</span> <span class="op">&lt;-</span> <span class="va">fig</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">strength</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">matrix.A</span><span class="op">)</span><span class="op">&lt;=</span><span class="fl">15</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">matrix.A</span><span class="op">)</span><span class="op">&lt;=</span><span class="fl">15</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">fig</span> <span class="op">&lt;-</span> <span class="va">fig</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">strength</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">fig</span> <span class="op">&lt;-</span> <span class="va">fig</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="va">fig</span> <span class="op">&lt;-</span> <span class="va">fig</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x.label</span>, y <span class="op">=</span> <span class="va">y.label</span><span class="op">)</span><span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_linedraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span></span>
<span>            angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">matrix.A</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">20</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="co"># too many species</span></span>
<span>        <span class="va">fig</span> <span class="op">&lt;-</span> <span class="va">fig</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>            axis.title.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            axis.text.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            axis.ticks.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">matrix.A</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">20</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="co"># too many resources</span></span>
<span>        <span class="va">fig</span> <span class="op">&lt;-</span> <span class="va">fig</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>            axis.title.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            axis.ticks.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">fig</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">makeHeatmap</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dist.community.initial.df</span><span class="op">)</span>,</span>
<span>            title <span class="op">=</span> <span class="st">"dissimilarity matrix"</span>,</span>
<span>            x.label <span class="op">=</span> <span class="st">"community.1"</span>,</span>
<span>            y.label <span class="op">=</span> <span class="st">"community.2"</span><span class="op">)</span></span></code></pre></div>
<p><img src="caseStudy2-NutrientThreshold_files/figure-html/plots-1.png" width="864"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We skip plotting of the initial community UMAP; overly simple case.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="initialize-shared-parameters">initialize shared parameters<a class="anchor" aria-label="anchor" href="#initialize-shared-parameters"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crm_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    n_species <span class="op">=</span> <span class="va">n_species</span>,</span>
<span>    n_resources <span class="op">=</span> <span class="va">n_resources</span>,</span>
<span>    x0 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    E <span class="op">=</span> <span class="va">E</span>,</span>
<span>    resources <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">n_resources</span><span class="op">)</span>,</span>
<span>    monod_constant <span class="op">=</span> <span class="va">monod_constant</span>,</span>
<span>    migration_p <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    stochastic <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    t_start <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    t_end <span class="op">=</span> <span class="fl">50</span>,</span>
<span>    t_step <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    t_store <span class="op">=</span> <span class="va">t_store</span>,</span>
<span>    growth_rates <span class="op">=</span> <span class="va">growth_rates</span>,</span>
<span>    norm<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generate-resource-gradients">generate resource gradients<a class="anchor" aria-label="anchor" href="#generate-resource-gradients"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resourceConcentration</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">^</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span>,<span class="fl">1</span><span class="op">)</span> <span class="co"># 1 to 10000</span></span>
<span><span class="va">n.medium</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">density.medium</span> <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">resource.initial.df</span> <span class="op">&lt;-</span> <span class="fu">gradient.df.generator</span><span class="op">(</span>n_row <span class="op">=</span> <span class="va">n.medium</span>, n_col <span class="op">=</span> <span class="va">n_resources</span>, density_row <span class="op">=</span> <span class="va">density.medium</span>, max_gradient <span class="op">=</span> <span class="fl">0.7</span>, error_interval <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1</span></span>
<span><span class="co">## [1] 2</span></span>
<span><span class="co">## [1] 3</span></span>
<span><span class="co">## [1] 4</span></span>
<span><span class="co">## [1] 5</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="test-one-run">test one run<a class="anchor" aria-label="anchor" href="#test-one-run"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crmExample</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulateConsumerResource.html">simulateConsumerResource</a></span><span class="op">(</span></span>
<span>    n_species <span class="op">=</span> <span class="va">n_species</span>,</span>
<span>    n_resources <span class="op">=</span> <span class="va">n_resources</span>,</span>
<span>    E <span class="op">=</span> <span class="va">E</span>,</span>
<span>    x0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">community.initial.df</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>,</span>
<span>    resources <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">resourceConcentration</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">*</span><span class="va">resource.initial.df</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>,</span>
<span>    growth_rates <span class="op">=</span> <span class="va">growth_rates</span>,</span>
<span>    monod_constant <span class="op">=</span> <span class="va">monod_constant</span>,</span>
<span>    stochastic <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    t_end <span class="op">=</span> <span class="fl">50</span>,</span>
<span>    t_step <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    t_store <span class="op">=</span> <span class="fl">50</span>,</span>
<span>    norm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">makePlot</span><span class="op">(</span><span class="va">crmExample</span><span class="op">$</span><span class="va">matrix</span><span class="op">)</span></span>
<span><span class="fu">makePlotRes</span><span class="op">(</span><span class="va">crmExample</span><span class="op">$</span><span class="va">resources</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generate-simulations-and-store-the-final-community-in-community-simulation">generate simulations and store the final community in
community.simulation<a class="anchor" aria-label="anchor" href="#generate-simulations-and-store-the-final-community-in-community-simulation"></a>
</h3>
<p>In this step, the final relative abundance table is
basisComposition_prop</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">community.simulation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">counter_i</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">resConc</span> <span class="kw">in</span> <span class="va">resourceConcentration</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">medium</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n.medium</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">crm_params</span><span class="op">$</span><span class="va">resources</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">resource.initial.df</span><span class="op">[</span><span class="va">medium</span>,<span class="op">]</span><span class="op">*</span><span class="va">resConc</span><span class="op">)</span></span>
<span>        <span class="va">paramx0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">community.initial.df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">crm_param_iter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">paramx0</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"resConc"</span>, <span class="va">resConc</span>, <span class="st">"medium"</span>, <span class="va">medium</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">crmMoments</span> <span class="op">&lt;-</span> <span class="fu">generateSimulations</span><span class="op">(</span>model <span class="op">=</span> <span class="st">"simulateConsumerResource"</span>,</span>
<span>                                          params_list <span class="op">=</span> <span class="va">crm_params</span>,</span>
<span>                                          param_iter <span class="op">=</span> <span class="va">crm_param_iter</span>,</span>
<span>                                          n_instances <span class="op">=</span> <span class="va">n.instances</span>,</span>
<span>                                          t_end <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span>        <span class="va">community.simulation</span><span class="op">[[</span><span class="va">counter_i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">crmMoments</span>, <span class="va">getCommunity</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">counter_i</span> <span class="op">&lt;-</span> <span class="va">counter_i</span> <span class="op">+</span><span class="fl">1</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">basisComposition</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind.data.frame</span>, <span class="va">community.simulation</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">counter_i</span>, <span class="va">community.simulation</span><span class="op">)</span></span>
<span><span class="va">basisComposition_prop</span> <span class="op">&lt;-</span> <span class="va">basisComposition</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">basisComposition</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="make-umap-plots">make umap plots<a class="anchor" aria-label="anchor" href="#make-umap-plots"></a>
</h3>
<p>In this step, plot result is stored in umap_CRM_gradient_plot, and
this is visualized in different facets.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">concentration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">resourceConcentration</span>, each <span class="op">=</span> <span class="va">n.medium</span><span class="op">*</span><span class="va">n.community</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">medium</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n.medium</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">n.community</span> ,times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">resourceConcentration</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="va">community</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n.community</span><span class="op">)</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">resourceConcentration</span><span class="op">)</span><span class="op">*</span><span class="va">n.medium</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># makeUMAP(basisComposition, group = medium, group2 = concentration, gradient_title = 'Medium')</span></span>
<span></span>
<span><span class="co"># Visualize with UMAP </span></span>
<span></span>
<span><span class="co">## Provide the community data as TreeSE object</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://bioconductor.org/packages/scater/" class="external-link">scater</a></span><span class="op">)</span></span>
<span><span class="va">tse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TreeSummarizedExperiment/man/TreeSummarizedExperiment-constructor.html" class="external-link">TreeSummarizedExperiment</a></span><span class="op">(</span></span>
<span>                    assays<span class="op">=</span><span class="fu">SimpleList</span><span class="op">(</span>abundances<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">basisComposition</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            colData<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html" class="external-link">DataFrame</a></span><span class="op">(</span>Medium<span class="op">=</span><span class="va">medium</span>,</span>
<span>                              Concentration<span class="op">=</span><span class="va">concentration</span>,</span>
<span>                      Community<span class="op">=</span><span class="va">community</span></span>
<span>                      <span class="op">)</span></span>
<span>            <span class="op">)</span></span>
<span><span class="co">## Add UMAP</span></span>
<span><span class="va">tse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/runUMAP.html" class="external-link">runUMAP</a></span><span class="op">(</span><span class="va">tse</span>, name <span class="op">=</span> <span class="st">"UMAP"</span>, exprs_values <span class="op">=</span> <span class="st">"abundances"</span><span class="op">)</span></span>
<span><span class="co">## Plot UMAP</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/plotReducedDim.html" class="external-link">plotReducedDim</a></span><span class="op">(</span><span class="va">tse</span>, <span class="st">"UMAP"</span>, colour_by<span class="op">=</span><span class="st">"Medium"</span>, shape_by<span class="op">=</span><span class="st">"Concentration"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Same for compositional abundance data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/microbiome/mia" class="external-link">mia</a></span><span class="op">)</span></span>
<span><span class="co">## -- add relative abundances;</span></span>
<span><span class="va">tse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mia/man/transformCounts.html" class="external-link">transformSamples</a></span><span class="op">(</span><span class="va">tse</span>, assay_name<span class="op">=</span><span class="st">"abundances"</span>, method<span class="op">=</span><span class="st">"relabundance"</span><span class="op">)</span></span>
<span><span class="va">tse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/runUMAP.html" class="external-link">runUMAP</a></span><span class="op">(</span><span class="va">tse</span>, name <span class="op">=</span> <span class="st">"UMAP_compositional"</span>, exprs_values <span class="op">=</span> <span class="st">"relabundance"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/plotReducedDim.html" class="external-link">plotReducedDim</a></span><span class="op">(</span><span class="va">tse</span>, <span class="st">"UMAP_compositional"</span>, colour_by<span class="op">=</span><span class="st">"Medium"</span>, shape_by<span class="op">=</span><span class="st">"Concentration"</span><span class="op">)</span></span>
<span><span class="co"># Replaces earlier: umap_CRM_gradient &lt;- umap(basisComposition_prop)</span></span>
<span></span>
<span><span class="co"># Finally with communities</span></span>
<span><span class="va">umap_CRM_gradient_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/plotReducedDim.html" class="external-link">plotReducedDim</a></span><span class="op">(</span><span class="va">tse</span>, <span class="st">"UMAP_compositional"</span>, colour_by<span class="op">=</span><span class="st">"Medium"</span>, shape_by<span class="op">=</span><span class="st">"Community"</span>, size_by<span class="op">=</span><span class="st">"Concentration"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualization-of-results">visualization of results<a class="anchor" aria-label="anchor" href="#visualization-of-results"></a>
</h3>
<p>In this part, different visualization of results demonstrate (in
various facets) the gradual change of communities’ beta diversity. The
first figure indicates that the initial community composition is more
important than the combinations of initial available resources.</p>
<p>The first sub-figure in the second figure demonstrates that in an
oligotrophic (less available nutrients) environment, communities won’t
change much in a given time, whilst the last two sub-figures resemble
each other, implying that the nutrient is no longer the limiting factor
of the beta-diversity of the community. This pattern is further
displayed in the following “curve plot”.</p>
<p>In the third figure, the second and the th community always stays
more similar, despite their initial dissimilarity, indicating that they
might belong to one community type. This can be validated by input 20 or
even 50 as n.community in this case study: communities turns into
clusters in each sub-figures.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># FIXME: the visual output can be polished later.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">umap_CRM_gradient_plot</span><span class="op">)</span></span>
<span><span class="va">umap_CRM_gradient_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">size_by</span> <span class="op">~</span> <span class="va">.</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span></span>
<span><span class="va">umap_CRM_gradient_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">colour_by</span> <span class="op">~</span> <span class="va">size_by</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span></span>
<span><span class="va">umap_CRM_gradient_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">shape_by</span> <span class="op">~</span> <span class="va">size_by</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span></span>
<span><span class="va">umap_CRM_gradient_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">shape_by</span> <span class="op">~</span> <span class="va">colour_by</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="saturation-curve-of-average-beta-diversity-between-communities-with-community-1">“saturation curve” of average beta-diversity between communities
with community 1<a class="anchor" aria-label="anchor" href="#saturation-curve-of-average-beta-diversity-between-communities-with-community-1"></a>
</h3>
<p>In this part, we’d like to demonstrate that the average distance from
other communities to community 1 will reach to a threshold of nutrients,
after which the average distance won’t increase along with the total
concentration of nutrients.</p>
<p>To do so, we first define a function calculating the mean distance to
the first community.</p>
</div>
<div class="section level3">
<h3 id="construct-a-function-taking-umap_crm_coor-as-df-and-return-the-mean-distance">construct a function taking umap_CRM_coor as df and return the mean
distance<a class="anchor" aria-label="anchor" href="#construct-a-function-taking-umap_crm_coor-as-df-and-return-the-mean-distance"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">average_distance</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">res_conc_type</span>, <span class="va">com_type</span>, <span class="va">method</span> <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">sub_df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">concentration</span> <span class="op">==</span> <span class="va">res_conc_type</span> <span class="op">&amp;</span> <span class="va">df</span><span class="op">$</span><span class="va">community</span> <span class="op">==</span> <span class="va">com_type</span>,<span class="op">]</span></span>
<span>    <span class="va">combines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/combn.html" class="external-link">combn</a></span><span class="op">(</span><span class="va">sub_df</span><span class="op">$</span><span class="va">medium</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="va">distances</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">combines</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">distances</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">sub_df</span><span class="op">[</span><span class="va">combines</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="co"># print(distances)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">distances</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="umap-distance-saturation-analysis">UMAP distance saturation analysis<a class="anchor" aria-label="anchor" href="#umap-distance-saturation-analysis"></a>
</h3>
<p>This shows how distance saturations could be calculated. Not
evaluated currently.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distance_saturation_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>concentration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                       community <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                       average_distance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#umap_CRM_coor &lt;- cbind(umap_CRM_coor, concentration, medium, community)</span></span>
<span><span class="va">umap_CRM_coor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/reducedDims.html" class="external-link">reducedDim</a></span><span class="op">(</span><span class="va">tse</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">tse</span><span class="op">)</span><span class="op">)</span> <span class="co"># cbind(umap_CRM_coor, concentration, medium, community)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">res_conc_type</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">concentration</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">com_type</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">community</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">ave_dist</span> <span class="op">&lt;-</span> <span class="fu">average_distance</span><span class="op">(</span><span class="va">umap_CRM_coor</span>, <span class="va">res_conc_type</span>, <span class="va">com_type</span><span class="op">)</span></span>
<span>        <span class="va">distance_saturation_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">distance_saturation_data</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">&lt;-</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">res_conc_type</span>, <span class="va">com_type</span>, <span class="va">ave_dist</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># View(distance_saturation_data)</span></span>
<span><span class="va">distance_saturation_data</span><span class="op">$</span><span class="va">average_distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">distance_saturation_data</span><span class="op">$</span><span class="va">average_distance</span><span class="op">)</span></span>
<span><span class="va">distance_saturation_data</span><span class="op">$</span><span class="va">concentration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">distance_saturation_data</span><span class="op">$</span><span class="va">concentration</span><span class="op">)</span></span>
<span><span class="va">distance_saturation_data</span><span class="op">$</span><span class="va">community</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">distance_saturation_data</span><span class="op">$</span><span class="va">community</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># distance_saturation_data_plot</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">distance_saturation_data</span>,</span>
<span>                                 <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">concentration</span>, <span class="va">average_distance</span>,</span>
<span>                                     color <span class="op">=</span> <span class="va">community</span>,</span>
<span>                                     group <span class="op">=</span> <span class="va">community</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">15</span>, <span class="fl">16</span>, <span class="fl">17</span>, <span class="fl">18</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"resource concentration"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"average distance between communities in UMAP"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Could be saved with:</span></span>
<span><span class="co"># ggsave(paste0("CRMgradient_distance_curve_mod.pdf"), plot = p, dpi = 300, width = 12, height = 10, units = "cm", scale = 2)</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Yagmur Simsek, Karoline Faust, Yu Gao, Emma Gheysen, Daniel Rios Garza, Tuomas Borman, Leo Lahti.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
